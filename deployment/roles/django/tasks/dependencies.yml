---
# Make sure the virtualenv is created and requirements are installed

- name: Upgrade pip
  pip:
    name: "{{ item }}"
    virtualenv: "{{ venv }}"
    state: latest
    virtualenv_python: python2
  with_items:
    - pip
    - setuptools

- name: Set up virtualenvwrapper post-activate hook
  template:
    src: postactivate.j2
    dest: "{{ venv }}/bin/postactivate"

- name: Install requirements
  pip:
    virtualenv: "{{ venv }}"
    chdir: "{{ project_home }}"
    requirements: "requirements/{{ env }}.txt"
    virtualenv_python: python2
  notify:
    - restart uwsgi
